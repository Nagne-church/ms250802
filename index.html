<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대요리문답 - 제2계명이 금하는 죄</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f0f2f5;
        }
        .infographic-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            border-left-width: 8px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .infographic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .icon-bg {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1.5rem;
            flex-shrink: 0;
        }
        .icon-bg svg {
            width: 28px;
            height: 28px;
            color: white;
        }
        .ask-question-btn {
            background-color: #4f46e5;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 1.5rem;
        }
        .ask-question-btn:hover {
            background-color: #4338ca;
        }
        #modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        #modal-backdrop.active {
            opacity: 1;
            pointer-events: auto;
        }
        #qa-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            z-index: 50;
            width: 90%;
            max-width: 650px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            height: 80vh;
            max-height: 700px;
        }
        #qa-modal.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }
        .chat-bubble {
            padding: 0.75rem 1rem;
            border-radius: 12px;
            max-width: 85%;
            word-wrap: break-word;
        }
        .chat-bubble.user {
            background-color: #4f46e5;
            color: white;
            align-self: flex-end;
        }
        .chat-bubble.assistant {
            background-color: #e5e7eb;
            color: #1f2937;
            align-self: flex-start;
        }
        .chat-bubble.assistant.thinking {
            display: flex;
            align-items: center;
        }
        .dot-flashing {
            position: relative;
            width: 6px;
            height: 6px;
            border-radius: 5px;
            background-color: #9ca3af;
            color: #9ca3af;
            animation: dotFlashing 1s infinite linear alternate;
            animation-delay: .5s;
            margin: 0 4px;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: '';
            display: inline-block;
            position: absolute;
            top: 0;
        }
        .dot-flashing::before {
            left: -10px;
            width: 6px;
            height: 6px;
            border-radius: 5px;
            background-color: #9ca3af;
            color: #9ca3af;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 0s;
        }
        .dot-flashing::after {
            left: 10px;
            width: 6px;
            height: 6px;
            border-radius: 5px;
            background-color: #9ca3af;
            color: #9ca3af;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 1s;
        }
        @keyframes dotFlashing {
            0% { background-color: #9ca3af; }
            50%, 100% { background-color: #e5e7eb; }
        }
    </style>
</head>
<body>
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 mb-2">제2계명이 금하는 죄</h1>
            <p class="text-lg md:text-xl text-gray-600">하나님께서 제정하지 않은 모든 예배 방식과 우상 숭배에 대한 심층 해설</p>
        </header>

        <main>
            <section id="chapter1" class="infographic-card" style="border-color: #3b82f6;">
                <div class="flex items-start md:items-center mb-4">
                    <div class="icon-bg" style="background-color: #3b82f6;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0012 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75z" />
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Chapter 1: 둘째 계명의 핵심 원리: 예배의 규정적 원리</h2>
                </div>
                <div class="prose max-w-none text-gray-700">
                    <p>십계명의 두 번째 계명은 <strong class="text-indigo-600">"너를 위하여 새긴 우상을 만들지 말고..."</strong>라는 금지 명령으로 시작합니다. 이는 단순히 눈에 보이는 형상을 만들지 말라는 의미를 넘어, 하나님께서 제정하지 않은 어떤 종교적 예배 방식도 고안하거나 운용하는 것을 금지하는 포괄적인 명령입니다.</p>
                    <p>개혁파 신앙의 핵심 원리 중 하나인 <strong class="text-indigo-600">'예배의 규정적 원리'</strong>가 바로 여기서 나옵니다. 이 원칙은 예배의 모든 요소는 인간의 생각이나 편의가 아닌, 오직 성경에 명시적으로 명령되었거나 합당하게 추론될 수 있는 것들로만 구성되어야 함을 의미합니다. 즉, 하나님께서 하라고 명하신 것만 행하고, 금하신 것은 물론, 명시적으로 지시하지 않은 것도 행하지 않는 것입니다. 이는 인간의 마음이 예배를 혼탁하게 하고 부패시키는 것을 막기 위한 하나님의 거룩한 지침입니다.</p>
                    <h3 class="text-lg font-semibold mt-4">금지되는 행위들:</h3>
                    <ul class="list-disc pl-5 space-y-2">
                        <li><strong>거짓 종교 용납:</strong> 개인적, 사회적 관계 속에서 거짓 종교에 대해 침묵하거나 방관하는 태도.</li>
                        <li><strong>이교적 의례 참여:</strong> 직장, 학교 등에서 행해지는 무속적이거나 이교적인 성격의 의식에 참여하는 행위.</li>
                        <li><strong>예배의 변질:</strong> 예배의 본질을 흐리는 공연, 드라마, 기복주의, 신비주의적 요소를 도입하는 것.</li>
                    </ul>
                </div>
                <button class="ask-question-btn">이 장에 대해 질문하기</button>
            </section>

            <section id="chapter2" class="infographic-card" style="border-color: #ef4444;">
                <div class="flex items-start md:items-center mb-4">
                    <div class="icon-bg" style="background-color: #ef4444;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Chapter 2: 금지된 형상화와 거짓 신 숭배</h2>
                </div>
                <div class="prose max-w-none text-gray-700">
                    <p>둘째 계명은 하나님을 눈에 보이는 형태로 만들려는 모든 시도를 엄격히 금지합니다. 이는 성부, 성자, 성령 삼위일체 하나님의 어느 위격이든 마찬가지입니다. 하나님을 형상화하려는 시도 이면에는, 보이지 않는 하나님을 통제하고 소유하려는 인간의 교만한 심리가 자리 잡고 있습니다.</p>
                    <h3 class="text-lg font-semibold mt-4">구체적인 죄의 형태:</h3>
                    <ul class="list-disc pl-5 space-y-2">
                        <li><strong>하나님의 형상화:</strong> 성부 하나님을 산신령처럼, 성자 하나님을 특정 인종의 모습으로, 성령 하나님을 비둘기나 불꽃으로 그리는 등, 마음속으로나 실제적으로 하나님의 형상을 만드는 행위.</li>
                        <li><strong>형상을 통한 예배:</strong> 만들어진 형상이나 그림에 신성한 힘이 깃들어 있다고 믿고, 그것을 통해 예배하거나 의지하는 행위.</li>
                        <li><strong>영적 종속:</strong> 특정 영적 지도자나 점술가에게 맹목적으로 의존하여, 말씀의 진리에 따른 신앙 양심과 인격적 자유를 포기하는 것.</li>
                        <li><strong>종교 다원주의:</strong> 모든 종교가 결국에는 하나의 신으로 통한다는 생각. 이는 성경이 말하는 유일하신 하나님에 대한 진리를 정면으로 부정하는 거짓 사상입니다.</li>
                    </ul>
                </div>
                <button class="ask-question-btn">이 장에 대해 질문하기</button>
            </section>

            <section id="chapter3" class="infographic-card" style="border-color: #f97316;">
                <div class="flex items-start md:items-center mb-4">
                    <div class="icon-bg" style="background-color: #f97316;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-15c-.621 0-1.125-.504-1.125-1.125v-9.75c0-.621.504-1.125 1.125-1.125h.375m15.75 0v.375c0 .621-.504 1.125-1.125 1.125h-1.5m1.5-1.5v-1.125c0-.621-.504-1.125-1.125-1.125h-1.5" />
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Chapter 3: 미신과 잘못된 예배 태도</h2>
                </div>
                <div class="prose max-w-none text-gray-700">
                    <p>하나님을 예배하는 방식과 태도 역시 둘째 계명의 중요한 부분입니다. 하나님이 정하신 예배와 규례를 벗어난 미신적 고안들이나, 예배 자체를 소홀히 여기는 태도는 모두 죄에 해당합니다.</p>
                    <h3 class="text-lg font-semibold mt-4">경계해야 할 태도와 행위:</h3>
                    <ul class="list-disc pl-5 space-y-2">
                        <li><strong>미신적 고안:</strong> 부적, 성물, 특정 의식 등을 통해 영적인 힘이나 은혜를 얻으려는 시도. 십자가조차 신비한 힘이 있는 물건으로 의지해서는 안 됩니다.</li>
                        <li><strong>성직 매매와 신성 모독:</strong> 교회의 직분이나 영적인 특권을 돈이나 세속적 이익으로 사려 하거나, 물질적 힘으로 영적 영향력을 과시하려는 행위.</li>
                        <li><strong>예배 경시 및 방해:</strong> 하나님이 정하신 예배와 규례를 소홀히 하거나, 비판하고, 참여를 방해하는 모든 행위.</li>
                        <li><strong>잘못된 예배 동기:</strong> 인간적인 감동이나 문화적 친숙함을 기준으로 예배 방식을 선택하거나, 다수결로 예배의 본질을 결정하려는 시도.</li>
                        <li><strong>마음의 오염:</strong> 예배 중에 세상적인 생각이나 쓸데없는 잡념으로 마음이 나뉘는 것.</li>
                    </ul>
                    <p class="mt-4">그러나 인간은 연약하여 예배에 온전히 집중하기 어렵습니다. 중요한 것은 <strong class="text-indigo-600">하나님을 예배하고자 하는 마음의 중심</strong>입니다. 우리의 불완전한 예배라도, 진정으로 하나님을 향한 마음이 있다면 그리스도의 중보를 통해 하나님께서 기쁘게 받으신다는 사실은 큰 위로와 은혜가 됩니다.</p>
                </div>
                <button class="ask-question-btn">이 장에 대해 질문하기</button>
            </section>
        </main>
    </div>

    <div id="modal-backdrop"></div>
    <div id="qa-modal">
        <div class="flex justify-between items-center p-4 border-b">
            <h3 id="modal-title" class="text-xl font-bold text-gray-800">질문하기</h3>
            <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div id="chat-window" class="flex-1 p-4 overflow-y-auto space-y-4 flex flex-col">
            </div>
        <div class="p-4 border-t bg-gray-50">
            <form id="qa-form" class="flex items-center space-x-2">
                <input type="text" id="question-input" class="flex-1 border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="여기에 질문을 입력하세요..." autocomplete="off">
                <button type="submit" class="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 disabled:bg-indigo-300 flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modalBackdrop = document.getElementById('modal-backdrop');
            const qaModal = document.getElementById('qa-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const qaForm = document.getElementById('qa-form');
            const questionInput = document.getElementById('question-input');
            const chatWindow = document.getElementById('chat-window');
            const modalTitle = document.getElementById('modal-title');
            
            let currentChapterContext = '';
            let currentChapterTitle = '';

            document.querySelectorAll('.ask-question-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const section = e.target.closest('section');
                    currentChapterTitle = section.querySelector('h2').textContent.trim();
                    currentChapterContext = section.querySelector('.prose').innerText;
                    
                    modalTitle.textContent = `${currentChapterTitle}에 대해 질문하기`;
                    chatWindow.innerHTML = `
                        <div class="chat-bubble assistant">
                            안녕하세요! <strong>'${currentChapterTitle}'</strong> 내용에 대해 무엇이든 물어보세요. 이 장의 내용을 바탕으로 답변해 드리겠습니다.
                        </div>
                    `;
                    openModal();
                });
            });

            function openModal() {
                document.body.style.overflow = 'hidden';
                modalBackdrop.classList.add('active');
                qaModal.classList.add('active');
                questionInput.focus();
            }

            function closeModal() {
                document.body.style.overflow = '';
                modalBackdrop.classList.remove('active');
                qaModal.classList.remove('active');
            }

            closeModalBtn.addEventListener('click', closeModal);
            modalBackdrop.addEventListener('click', closeModal);

            qaForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userQuestion = questionInput.value.trim();
                if (!userQuestion) return;

                appendMessage(userQuestion, 'user');
                questionInput.value = '';
                qaForm.querySelector('button').disabled = true;

                const thinkingBubble = appendMessage('', 'assistant', true);
                
                try {
                    const finalPrompt = \`
                        당신은 [콘텐츠 주제]에 대해 설명하는 전문 AI 어시스턴트입니다. 아래에 명시된 두 가지 규칙의 우선순위를 반드시 지켜서 사용자의 질문에 답변해 주세요.

                        [규칙 1: 주어진 자료 우선의 원칙]
                        - 최우선적으로, 아래에 제공되는 "[강의 노트 내용]"에 근거하여 답변을 생성해야 합니다.
                        - 자료에 명시된 사실과 논리를 바탕으로 질문에 직접적으로 그리고 자연스럽게 답해주세요.

                        [규칙 2: 지식 확장 및 보충의 원칙]
                        - 만약 "[강의 노트 내용]"만으로 답변하기에 정보가 불충분하거나 관련 내용이 없을 경우에는, 당신의 전통적 개혁신학의 전문 지식을 활용하여 답변을 보충할 수 있습니다.(반드시 전통 개혁신학에 근거해야 합니다.)
                        - 이 경우, 보충된 내용이 원래 자료에 없었음을 명확히 하기 위해 "보충 설명을 드리자면..." 과 같이 서술을 시작해주세요.

                        ---
                        [강의 노트 제목]: \${currentChapterTitle}
                        ---
                        [강의 노트 내용]:
                        \${currentChapterContext}
                        ---
                        [사용자 질문]:
                        \${userQuestion}
                    \`;

                    const response = await fetch('/api/ask-gemini', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ prompt: finalPrompt }),
                    });

                    if (!response.ok) {
                        throw new Error(\`HTTP error! status: \${response.status}\`);
                    }

                    const data = await response.json();
                    
                    let assistantResponse = "죄송합니다. 답변을 생성하는 데 문제가 발생했습니다.";
                    if (data && data.candidates && Array.isArray(data.candidates) && data.candidates.length > 0) {
                        const candidate = data.candidates[0];
                        if (candidate && candidate.content && candidate.content.parts && Array.isArray(candidate.content.parts) && candidate.content.parts.length > 0) {
                            const part = candidate.content.parts[0];
                            if (part && part.text) {
                                assistantResponse = part.text;
                            }
                        }
                    }
                    
                    thinkingBubble.remove();
                    appendMessage(assistantResponse, 'assistant');

                } catch (error) {
                    console.error('Error fetching API:', error);
                    thinkingBubble.remove();
                    appendMessage('죄송합니다. 오류가 발생하여 답변을 가져올 수 없습니다. 잠시 후 다시 시도해주세요.', 'assistant');
                } finally {
                    qaForm.querySelector('button').disabled = false;
                    questionInput.focus();
                }
            });

            function appendMessage(text, sender, isThinking = false) {
                const messageBubble = document.createElement('div');
                messageBubble.classList.add('chat-bubble', sender);
                
                if (isThinking) {
                    messageBubble.classList.add('thinking');
                    messageBubble.innerHTML = '<div class="dot-flashing"></div>';
                } else {
                    let formattedText = text
                        .replace(/</g, "&lt;")
                        .replace(/>/g, "&gt;")
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\n/g, '<br>');
                    messageBubble.innerHTML = formattedText;
                }
                
                chatWindow.appendChild(messageBubble);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                return messageBubble;
            }
        });
    </script>
</body>
</html>
